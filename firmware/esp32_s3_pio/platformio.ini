; PlatformIO Project Configuration File
; ESP32-S3 Rack Controller Firmware
;
; Build flags for credentials are pulled from environment or secrets.h

[platformio]
default_envs = s3dev

[env]
platform = espressif32
framework = arduino
monitor_speed = 115200
lib_deps = 
    knolleary/PubSubClient@^2.8
    bblanchon/ArduinoJson@^7.0.0

; Common build flags
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1

[env:s3dev]
board = esp32-s3-devkitc-1
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

; Uncomment below to use ESP-IDF framework instead of Arduino
; framework = espidf

build_flags = 
    ${env.build_flags}
    -DTARGET_NAME=\"s3\"
    ; Git SHA injected by CI - fallback for local builds
    !echo '-DFW_VERSION=\"'$(git rev-parse --short HEAD 2>/dev/null || echo 'local')'\"'

upload_speed = 921600

; Optional: OTA configuration placeholder
; upload_protocol = espota
; upload_port = 192.168.1.xxx

[env:s3release]
board = esp32-s3-devkitc-1
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

build_flags = 
    ${env.build_flags}
    -DTARGET_NAME=\"s3\"
    -DNDEBUG
    -Os
    !echo '-DFW_VERSION=\"'$(git rev-parse --short HEAD 2>/dev/null || echo 'local')'\"'

build_type = release
